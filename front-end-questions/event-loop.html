<!DOCTYPE html>
<html>

<body>
<div class="outer">
    Welcome!
    <p>
        <button type="button" class="inner">
            Start the interview
        </button>
    </p>
</div>

<script>
    // What is the output of clicking the start button?
    // Tests understanding of the event loop as well as event bubbling.
    (function () {
        // Get a reference to HTML elements in event-loop-intermediate.html.
        let outerElement = document.querySelector('.outer'),
            innerElement = document.querySelector('.inner');

        // Listen for attribute changes to the outer element.
        new MutationObserver(function () {
            console.log('outer attribute mutated');
        }).observe(outerElement, {
            attributes: true
        });

        // Attach click handler to both elements.
        innerElement.addEventListener('click', () => onClick('innerElement '));
        outerElement.addEventListener('click', () => onClick('outerElement '));

        // Define click listener.
        function onClick(msg) {
            console.log(msg + 'click event');

            setTimeout(function () {
                console.log(msg + 'click handler timeout');
            }, 0);

            Promise.resolve().then(function () {
                console.log(msg + 'click handler promise');
            });

            outerElement.setAttribute('data-random', Math.random());
        }
    })();


    // The browser drills down the DOM tree to the event target, capturing the parents of the event target. Because we added a default listener, our listeners are executed in the bubble phase, not the capture phase.
    // "innerElement click event" appears because the onClick listener adds the handler bound to the node with the "inner" class to the task queue and the call to log executes synchronously from the call stack.
    // "innerElement click handler promise" appears because the Promise is added to the micro-task queue and there are no other synchronous log messages.
    // "outer attribute mutated" appears because it is added to the micro-task queue after the Promise.
    // "outerElement click event" appears because the original onClick listener bubbles up to the parent node.
    // "outerElement click handler promise" appears because the Promise is added to the micro-task queue.
    // "outer attribute mutated" appears because the MutationObserver callback is added to teh micro-task queue.
    // The task's call stack and micro-task queue are now exhausted, so the loop completes.
    // "innerElement click handler timeout" appears because it is next in the task queue.
    // "outerElement click handler timeout" appears at the next turn of the event loop, because it was queued after the inner element timeout.
</script>
</body>

</html>